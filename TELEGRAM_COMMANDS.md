# Telegram Bot 命令指南

本项目的 Telegram Bot 支持以下命令。

---

## 📊 `/stats` - 查看统计信息

查看审核请求的统计数据。

**用法**:
```
/stats
```

**输出示例**:
```
📊 CDN 预热审核统计

⏳ 待审核: 3
✅ 已批准: 15
❌ 已拒绝: 2
📝 总计: 20
```

---

## ⏳ `/pending` - 查看待审核列表

显示最近 10 条待审核的请求（包括 URL 预览）。

**用法**:
```
/pending
```

**输出示例**:
```
⏳ 待审核列表（最近 3 条）

🆔 ID: 123
🎞 流浪地球2 (Movie)
🔗 .../流浪地球2.mp4
⏰ 2026-01-22 10:30:00

🆔 ID: 124
🎞 权力的游戏 S01E01 (Episode)
🔗 .../权力的游戏 - S01E01 - 凛冬将至.mkv
⏰ 2026-01-22 10:31:00

🆔 ID: 125
🎞 教父 (Movie)
🔗 .../教父.mkv
⏰ 2026-01-22 10:32:00

💡 使用 /detail ID 查看完整信息
```

---

## 🔍 `/detail <ID>` - 查看请求详情

查看指定请求的完整详细信息，包括完整的 URL、路径等。

**用法**:
```
/detail 123
```

**参数**:
- `ID` - 请求 ID（必填，从 `/pending` 或批量消息中获取）

**输出示例**:

### 待审核状态
```
⏳ 请求详情

🆔 请求 ID: 123
🎞 媒体名称: 流浪地球2
📂 类型: Movie
📊 状态: pending

📍 Emby 路径:
/media/电影/流浪地球2 (2023)/流浪地球2.mp4

💾 宿主机路径:
/media/电影/流浪地球2 (2023)/流浪地球2.mp4

🔗 CDN 预热 URL:
https://qiufeng.huaijiufu.com/电影/流浪地球2 (2023)/流浪地球2.mp4

⏰ 创建时间: 2026-01-22 10:30:00

[✅ 同意预热] [❌ 拒绝]
```

### 已审核状态
```
✅ 请求详情

🆔 请求 ID: 100
🎞 媒体名称: 复仇者联盟4：终局之战
📂 类型: Movie
📊 状态: approved

📍 Emby 路径:
/media/电影/复仇者联盟4：终局之战 (2019)/...

💾 宿主机路径:
/media/电影/复仇者联盟4：终局之战 (2019)/...

🔗 CDN 预热 URL:
https://qiufeng.huaijiufu.com/电影/复仇者联盟4：终局之战 (2019)/...

⏰ 创建时间: 2026-01-22 09:00:00
✅ 审核时间: 2026-01-22 09:05:00
👤 审核人: 张三 (@zhangsan)
```

**特点**:
- ✅ 显示完整的 CDN URL（可直接复制）
- ✅ 显示完整的路径信息
- ✅ 如果是待审核状态，可直接批准/拒绝
- ✅ 显示审核历史（审核人、时间）

---

## 🎯 使用场景

### 场景 1: 快速查看统计

```
管理员: /stats
Bot: 📊 待审核: 5, 已批准: 120, 已拒绝: 8
```

### 场景 2: 检查待审核队列

```
管理员: /pending
Bot: [显示最近 10 条待审核]
管理员: 看到 ID: 123
```

### 场景 3: 查看完整信息并审核

```
管理员: /detail 123
Bot: [显示完整详情，包括完整 URL]
     [✅ 同意预热] [❌ 拒绝]
管理员: [点击按钮批准]
Bot: ✅ 已同意
     CDN 预热已提交
     任务 ID: xxx
```

### 场景 4: 批量消息中查看详情

```
Bot: 🎬 CDN 预热审核请求（共 5 项）
     1. 🎬 流浪地球2
        📎 .../流浪地球2.mp4
        🆔 ID: 123
     ...

管理员: /detail 123
Bot: [显示完整 URL 和详细信息]
```

---

## 💡 使用技巧

### 技巧 1: 快速审核

如果 URL 在批量消息中已经足够清晰，可以直接点击按钮批准。

如果需要查看完整 URL 确认，使用 `/detail ID`。

### 技巧 2: 批量审核工作流

1. 收到批量消息
2. 浏览每个媒体的文件名
3. 如果不确定，使用 `/detail ID` 查看完整 URL
4. 逐个点击按钮批准或拒绝

### 技巧 3: 定期检查待审核

设置提醒每天检查一次：
```
/pending
```

如果有待审核的，逐个使用 `/detail` 查看并处理。

### 技巧 4: 复制 URL

在 `/detail` 命令的输出中，URL 使用 `<code>` 标签包裹，可以：
1. 长按 URL 文本
2. 选择"复制"
3. 粘贴到浏览器测试

---

## 🔔 通知类型

### 批量推送通知

当队列达到阈值（默认 30 秒或 10 条）时，会收到批量消息：

```
🎬 CDN 预热审核请求（共 5 项）

1. 🎬 流浪地球2
   📎 .../流浪地球2.mp4
   🆔 ID: 2

2. 🎬 教父
   📎 .../教父.mkv
   🆔 ID: 3

...

💡 使用下方按钮批准或拒绝每个项目
📝 点击 URL 可查看完整链接

[✅ 流浪地球2] [❌]
[✅ 教父] [❌]
...
```

### 审核结果通知

点击按钮后，消息会更新为结果：

**批准**:
```
✅ 已同意预热

🎞 媒体: 流浪地球2
🔗 URL: https://...

👤 审核人: 张三 (@zhangsan)
📝 结果: CDN 预热已提交
       任务 ID: task_xxx
```

**拒绝**:
```
❌ 已拒绝

🎞 媒体: 流浪地球2
🔗 URL: https://...

👤 审核人: 张三 (@zhangsan)
📝 结果: 不会进行预热
```

---

## 🚨 错误处理

### 无效的请求 ID

```
管理员: /detail 99999
Bot: ❌ 未找到请求 ID: 99999
```

### 已处理的请求

```
管理员: [点击已批准请求的按钮]
Bot: ⚠️ 该请求已经被处理过
     状态: approved
     审核人: 张三 (@zhangsan)
```

### 命令格式错误

```
管理员: /detail
Bot: ❌ 用法: /detail 请求ID
     示例: /detail 123
```

---

## 📚 相关文档

- [README.md](./README.md) - 项目说明
- [BATCH_PUSH.md](./BATCH_PUSH.md) - 批量推送机制
- [TELEGRAM_SETUP.md](./TELEGRAM_SETUP.md) - Bot 配置指南
- [CHANGELOG.md](./CHANGELOG.md) - 更新日志

---

## 🎉 最佳实践

1. **及时审核**: 定期使用 `/pending` 检查待审核队列
2. **仔细确认**: 使用 `/detail` 查看完整 URL，确保路径正确
3. **批量处理**: 批量消息可以快速浏览多个请求
4. **记录追踪**: 使用 `/stats` 了解整体审核情况

---

**问题反馈**: https://github.com/Sdongmaker/emby-cdn-preheat/issues
